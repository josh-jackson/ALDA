<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.4.0">

  

  
  
  
  
  
  

  

  
  
  
    
  
  <meta name="description" content="tidyr and lmer">

  
  <link rel="alternate" hreflang="en-us" href="/workshops/workshop-2/">

  


  

  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css" crossorigin="anonymous" title="hl-light" disabled>
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.301ab7eca2ca7d1311ed71a9afa2cc4f.css">

  

  
  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/workshops/workshop-2/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@jackson_josh_">
  <meta property="twitter:creator" content="@jackson_josh_">
  
  <meta property="og:site_name" content="Applied Longitudinal Data Analysis">
  <meta property="og:url" content="/workshops/workshop-2/">
  <meta property="og:title" content="Workshop #2 | Applied Longitudinal Data Analysis">
  <meta property="og:description" content="tidyr and lmer"><meta property="og:image" content="/img/icon-192.png">
  <meta property="twitter:image" content="/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-09-04T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2019-09-04T00:00:00&#43;00:00">
  

  


  





  <title>Workshop #2 | Applied Longitudinal Data Analysis</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="dark">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Applied Longitudinal Data Analysis</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/lectures"><span>Lectures</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/workshops"><span>Workshops</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/homeworks"><span>Homeworks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/syllabus"><span>Syllabus</span></a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Workshop #2</h1>

  

  
    



<meta content="2019-09-04 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2019-09-04 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Sep 4, 2019</time>
  </span>
  

  

  

  
  
  

  
  

  
    

  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<div id="TOC">
<ul>
<li><a href="#tidyr">tidyr</a><ul>
<li><a href="#wide-and-long-form">Wide and Long form</a></li>
</ul></li>
<li><a href="#lme4">lme4</a><ul>
<li><a href="#example">Example</a></li>
<li><a href="#how-to-calculate-icc">How to calculate ICC?</a></li>
<li><a href="#exploring-beyond-the-summary">Exploring beyond the summary</a><ul>
<li><a href="#what-do-the-random-effects-look-like">what do the random effects look like?</a></li>
</ul></li>
<li><a href="#adding-time-to-the-mlm">Adding time to the MLM</a><ul>
<li><a href="#fixed-slope">Fixed slope</a></li>
<li><a href="#random-slope">Random slope</a></li>
</ul></li>
<li><a href="#testing-models">Testing models</a><ul>
<li><a href="#why-treating-time-is-so-important">Why treating time is so important</a></li>
</ul></li>
<li><a href="#random-effects">Random effects</a><ul>
<li><a href="#calculation-of-random-effect-confidence-interval">Calculation of random effect confidence interval</a></li>
</ul></li>
<li><a href="#using-simulations-to-get-better-estimates-of-confidence-around-our-estimates">Using simulations to get better estimates of confidence around our estimates</a><ul>
<li><a href="#caterpillar-plots">Caterpillar plots</a></li>
<li><a href="#density-of-individual-random-effects">Density of individual random effects</a></li>
</ul></li>
<li><a href="#comparing-to-a-standard-linear-model">Comparing to a standard linear model</a><ul>
<li><a href="#comparing-models">Comparing models</a></li>
</ul></li>
<li><a href="#predictions-and-prediction-intervals">Predictions and prediction intervals</a><ul>
<li><a href="#predictions-and-prediction-intervals-1">Predictions and prediction intervals</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<div id="tidyr" class="section level1">
<h1>tidyr</h1>
<div id="wide-and-long-form" class="section level2">
<h2>Wide and Long form</h2>
<p>Depending on what type of analysis you want to perform you may need to restructure your data. I recommend the combination of tidyr and dplyr (among others) to restructure and manage your dataframes. The first decision you need to make is whether you want your data structured in a long or a wide format. There are multiple names to refer to these two types: multivariate vs univariate, person-level vs person-period, etc but they all refer to the same idea. How to structure your data depends on both what level of analysis (individual, dyad, household) and what type of analyses (MLM/SEM). Typically our focus is on individuals.</p>
<p>Wide form is common among non-longitudinal data. It has one line per individual with all of their repeated measures in the same row, each with some name to distinguish which assessment wave the data came from. In general, this format is used for SEM.</p>
<pre><code>## # A tibble: 3 x 4
##      ID ext_1 ext_2 ext_3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     4     4     4
## 2     2     6     5     4
## 3     3     4     5     6</code></pre>
<p>In contrast, long format has a row per observation. Thus, participants likely have many rows, each one referring to a different assessment wave. There are fewer variables in this format which makes organization somewhat easier. Thus this has been referred to as “Tidy” data. Graphing with ggplot is facilitated when using tidy data such as being in the long format.</p>
<pre><code>## # A tibble: 9 x 3
##      ID  time   ext
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1     4
## 2     1     2     4
## 3     1     3     4
## 4     2     1     6
## 5     2     2     5
## 6     2     3     4
## 7     3     1     4
## 8     3     2     5
## 9     3     3     6</code></pre>
<p>How do you go back and forth? We use the tidyr package! As of a few months ago, you would use the gather and the spread functions. Now these are being phased out and are being replaced by pivot_longer and pivot_wider. The functions work similar but the newer ones are a little more intuitive both in terms of remembering the correct function name as well as well adding more bells and whistles.</p>
<p>Gather and pivot_longer goes from wide to long.</p>
<pre class="r"><code>library(tidyr)

wide_to_long &lt;- wide %&gt;% 
  gather(ext_1:ext_3,key = &quot;time&quot;, value = &quot;ext&quot;) 
wide_to_long</code></pre>
<pre><code>## # A tibble: 9 x 3
##      ID time    ext
##   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
## 1     1 ext_1     4
## 2     2 ext_1     6
## 3     3 ext_1     4
## 4     1 ext_2     4
## 5     2 ext_2     5
## 6     3 ext_2     5
## 7     1 ext_3     4
## 8     2 ext_3     4
## 9     3 ext_3     6</code></pre>
<pre class="r"><code>library(tidyr)

wide_to_long.p &lt;- wide %&gt;% 
  pivot_longer(-ID, names_to = &quot;time&quot;, values_to = &quot;ext&quot;) 
wide_to_long.p</code></pre>
<pre><code>## # A tibble: 9 x 3
##      ID time    ext
##   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
## 1     1 ext_1     4
## 2     1 ext_2     4
## 3     1 ext_3     4
## 4     2 ext_1     6
## 5     2 ext_2     5
## 6     2 ext_3     4
## 7     3 ext_1     4
## 8     3 ext_2     5
## 9     3 ext_3     6</code></pre>
<p>Note the similarities. The key in all three is to 1. identify which columns need to be reshaped. Here is it all of them besides ID. 2. we need to name the newly created variable that consists of the old column names (here time). 3. we need to name what those values represent (here levels of extraversion)</p>
<p>The separate function could be used to get only the assessment wave number. This might be useful when combining data together or for creating a common time metric for everyone.</p>
<pre class="r"><code>wide_to_long2 &lt;- wide_to_long %&gt;% 
  separate(time, into = c(&quot;omit&quot;, &quot;wave&quot;), sep = &quot;_&quot;, convert = TRUE) %&gt;%
  dplyr::select(-omit) %&gt;% 
  arrange(ID)
wide_to_long2</code></pre>
<pre><code>## # A tibble: 9 x 3
##      ID  wave   ext
##   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
## 1     1     1     4
## 2     1     2     4
## 3     1     3     4
## 4     2     1     6
## 5     2     2     5
## 6     2     3     4
## 7     3     1     4
## 8     3     2     5
## 9     3     3     6</code></pre>
<pre class="r"><code># Note that the seperate function will identify non numeric characters and use that to seperate the values. You can omit the sep = function to check yourself. </code></pre>
<p>One issue that comes up here is that we have differing dates for each assessment. Ideally we would like to utilize that extra information.</p>
<pre><code>## # A tibble: 3 x 7
##      ID ext_1 ext_2 ext_3 date_1 date_2  date_3 
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  
## 1     1     4     4     4 1/1/10 5/1/10  8/1/10 
## 2     2     6     5     4 1/6/10 4/10/10 9/1/10 
## 3     3     4     5     6 1/8/10 4/25/10 9/13/10</code></pre>
<p>How do we fix it? The same way we would with multiple variables we want to convert. Wave, along with ID helps us keep track of what variables go with which person at which time. Together, the two serve as a unique identifier. To better understand the code go through each line to see what the intervening data frame looks like.</p>
<pre class="r"><code>long.date &lt;- wide.date %&gt;% 
  gather(-ID, key = &quot;time&quot;, value = &quot;value&quot;) %&gt;% 
  separate(time, into = c(&quot;variable&quot;, &quot;wave&quot;)) %&gt;% 
  spread(variable,value) 
long.date</code></pre>
<pre><code>## # A tibble: 9 x 4
##      ID wave  date    ext  
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
## 1     1 1     1/1/10  4    
## 2     1 2     5/1/10  4    
## 3     1 3     8/1/10  4    
## 4     2 1     1/6/10  6    
## 5     2 2     4/10/10 5    
## 6     2 3     9/1/10  4    
## 7     3 1     1/8/10  4    
## 8     3 2     4/25/10 5    
## 9     3 3     9/13/10 6</code></pre>
<p>One difficulty of creating a wave variable is whether or not the variables are named in a manner such that 1) assessment wave is easily identifiable (e.g. does _a always refer to the first wave whereas _b always refer to the second?) and 2) if that is consistent across variables. Having a wave identifier for your variables is important/necessary. Having an easily selected one (ie at the end of the variable name, hopefully separated by an underscore or a period). If assessment wave separators are embedded within the variable name it will be harder to covert your data. Often, variable data is attached at the end of a name such as SWB_4 to refer to the fourth item in a scale. This may obscure wave identification as in SWB_A_4. A similar naming problem can occur with multiple reports e.g,. SWB_4_parent. I recommend putting wave identification last. The difficulties become partly moot when working in long format (read: entering data in) as opposed to wide. This also becomes moot when stored in a separate dataset. This is another reason why you should use codebooks!</p>
<p>In the above code we used spread to go from long to wide as a means of creating a long dataset where there were multiple variables. Technically this is not a tidy dataset in that it comprises of both long and wide information, but it is the typical format used for MLM analyses.</p>
<p>Going from long to wide uses spread or pivot_wider function. We will utilize this when converting our MLM models to SEM models, but try the code below to see what happens.</p>
<pre class="r"><code>long_to_wide &lt;- long %&gt;% 
  spread(time, ext)
long_to_wide</code></pre>
<pre><code>## # A tibble: 3 x 4
##      ID   `1`   `2`   `3`
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     4     4     4
## 2     2     6     5     4
## 3     3     4     5     6</code></pre>
<p>Note that this is technically the dataframe format that we want. The problem is that our variable names are numeric. This often causes problems. When working with tibbles use backticks ’ to refer to the column e.g., select(‘1’). I’d recode into a more usable variable name.</p>
</div>
</div>
<div id="lme4" class="section level1">
<h1>lme4</h1>
<p>The basic function we will work with is lmer from the lme4 package</p>
<pre class="r"><code>library(lme4)</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<p>The package was developed to be similar to the lm function. The code will be similar to the formula for the combined model</p>
<p>Code for empty/null/intercept only model</p>
<pre class="r"><code>lmer(Y ~ 1 + (1 | subjects), data=example)</code></pre>
<p>Level 1
<span class="math display">\[ {Y}_{ij} = \beta_{0j}  +\varepsilon_{ij} \]</span></p>
<p>Level 2
<span class="math display">\[ {\beta}_{0j} = \gamma_{00} + U_{0j} \]</span></p>
<p>Combined
<span class="math display">\[ {Y}_{ij} = \gamma_{00} + U_{0j}  + \varepsilon_{ij} \]</span></p>
<p>1 is the way to reference the intercept. All additional fixed effects go outside the parentheses. Inside the parentheses are the random effects and residual terms. To the right of the vertical line is our level 1 residual term, which references the grouping variable. In this case, as with almost all longitudinal work, is the subject ID. To the left of the vertical line is the random effects we want to estimate. Right now this estimates only one random effect, one for the intercept.</p>
<p>It is possible to suppress a random intercept by putting a zero instead of a 1. If you do not put anything there the 1 is implied.</p>
<pre class="r"><code>lmer(y ~ 1 + time + (1 + time | subjects), data=data)

lmer(y ~ time + (time | subjects), data=data)
# both are equivalent</code></pre>
<div id="example" class="section level3">
<h3>Example</h3>
<pre class="r"><code>mod.1 &lt;- lmer(SMN7 ~ 1 + (1 | ID), data=example)
summary(mod.1)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: SMN7 ~ 1 + (1 | ID)
##    Data: example
## 
## REML criterion at convergence: -714.1
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.1575 -0.4728 -0.0232  0.4512  3.2750 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 0.001823 0.04270 
##  Residual             0.001302 0.03608 
## Number of obs: 225, groups:  ID, 91
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 0.106972   0.005106   20.95</code></pre>
</div>
<div id="how-to-calculate-icc" class="section level3">
<h3>How to calculate ICC?</h3>
<pre class="r"><code>0.001823/(0.001823 + 0.001302)</code></pre>
<pre><code>## [1] 0.58336</code></pre>
</div>
<div id="exploring-beyond-the-summary" class="section level2">
<h2>Exploring beyond the summary</h2>
<pre class="r"><code>class(mod.1)</code></pre>
<pre><code>## [1] &quot;lmerMod&quot;
## attr(,&quot;package&quot;)
## [1] &quot;lme4&quot;</code></pre>
<div id="what-do-the-random-effects-look-like" class="section level3">
<h3>what do the random effects look like?</h3>
<pre class="r"><code>library(sjPlot)
plot_model(mod.1, type = &quot;re&quot;, sort.est = TRUE)</code></pre>
<p><img src="/Workshops/2019-09-04-workshop-2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code>head(ranef(mod.1))</code></pre>
<pre><code>## $ID
##       (Intercept)
## 6   -0.0597240676
## 29  -0.0101119688
## 34  -0.0103698893
## 36  -0.0035902640
## 37  -0.0082433829
## 48   0.0455797808
## 53  -0.0222710793
## 54  -0.0066548052
## 58  -0.0060624543
## 61  -0.0271347235
## 66  -0.0123359896
## 67  -0.0026491341
## 69   0.0348398944
## 71  -0.0486040243
## 74   0.0484338355
## 75   0.0224228634
## 76  -0.0021583228
## 78   0.0224780927
## 79  -0.0054325535
## 80  -0.0194707993
## 81   0.0712662731
## 82   0.0053695094
## 85  -0.0532215425
## 86  -0.0388885304
## 87  -0.0387411472
## 89  -0.0208712287
## 91   0.0123812011
## 92  -0.0078125821
## 93   0.0430219016
## 94  -0.0543390588
## 96   0.0233440081
## 97  -0.0497003277
## 98  -0.0432302582
## 99   0.0104394983
## 101  0.0508032394
## 102 -0.0104344307
## 103 -0.0206130188
## 104 -0.0482473609
## 105 -0.0478231980
## 106 -0.0028045239
## 110  0.0418641247
## 112 -0.0109089622
## 114 -0.0549314098
## 115 -0.0013505715
## 116  0.0062422910
## 120  0.0300499418
## 122  0.0793976365
## 125  0.0532803435
## 127 -0.0105050866
## 129 -0.0448207025
## 135  0.0406255726
## 136 -0.0364069792
## 137 -0.0444890904
## 140 -0.0153440709
## 141  0.0770651692
## 142  0.0817077387
## 143  0.0072423981
## 144  0.0001680065
## 146 -0.0551006778
## 149 -0.0137965477
## 150  0.0091583792
## 152 -0.0187707293
## 153  0.0490992150
## 155 -0.0233396072
## 156 -0.0218943803
## 159 -0.0488368935
## 160  0.0024524455
## 162  0.0911638809
## 163  0.0155327007
## 165  0.0320764602
## 167 -0.0025217361
## 169  0.0647586755
## 171 -0.0397728293
## 174  0.0259232134
## 182 -0.0154177625
## 187 -0.0581588783
## 189  0.0348767402
## 190 -0.0030744230
## 193  0.0636533019
## 194  0.0099321407
## 201  0.0104848276
## 204  0.0414352908
## 205  0.0353188897
## 208  0.0033367444
## 209 -0.0346144188
## 211  0.0168223034
## 214 -0.0374146988
## 219  0.0564683729
## 222 -0.0262135788
## 223 -0.0228606119
## 229 -0.0484315899</code></pre>
<pre class="r"><code>head(coef(mod.1))</code></pre>
<pre><code>## $ID
##     (Intercept)
## 6    0.04724795
## 29   0.09686005
## 34   0.09660212
## 36   0.10338175
## 37   0.09872863
## 48   0.15255179
## 53   0.08470093
## 54   0.10031721
## 58   0.10090956
## 61   0.07983729
## 66   0.09463602
## 67   0.10432288
## 69   0.14181191
## 71   0.05836799
## 74   0.15540585
## 75   0.12939488
## 76   0.10481369
## 78   0.12945011
## 79   0.10153946
## 80   0.08750121
## 81   0.17823829
## 82   0.11234152
## 85   0.05375047
## 86   0.06808348
## 87   0.06823087
## 89   0.08610079
## 91   0.11935322
## 92   0.09915943
## 93   0.14999392
## 94   0.05263296
## 96   0.13031602
## 97   0.05727169
## 98   0.06374176
## 99   0.11741151
## 101  0.15777525
## 102  0.09653758
## 103  0.08635900
## 104  0.05872465
## 105  0.05914882
## 106  0.10416749
## 110  0.14883614
## 112  0.09606305
## 114  0.05204060
## 115  0.10562144
## 116  0.11321430
## 120  0.13702196
## 122  0.18636965
## 125  0.16025236
## 127  0.09646693
## 129  0.06215131
## 135  0.14759759
## 136  0.07056503
## 137  0.06248292
## 140  0.09162794
## 141  0.18403718
## 142  0.18867975
## 143  0.11421441
## 144  0.10714002
## 146  0.05187134
## 149  0.09317547
## 150  0.11613039
## 152  0.08820128
## 153  0.15607123
## 155  0.08363241
## 156  0.08507763
## 159  0.05813512
## 160  0.10942446
## 162  0.19813589
## 163  0.12250471
## 165  0.13904847
## 167  0.10445028
## 169  0.17173069
## 171  0.06719918
## 174  0.13289523
## 182  0.09155425
## 187  0.04881314
## 189  0.14184875
## 190  0.10389759
## 193  0.17062532
## 194  0.11690415
## 201  0.11745684
## 204  0.14840730
## 205  0.14229090
## 208  0.11030876
## 209  0.07235760
## 211  0.12379432
## 214  0.06955732
## 219  0.16344039
## 222  0.08075844
## 223  0.08411140
## 229  0.05854042</code></pre>
<pre class="r"><code>fixef(mod.1)</code></pre>
<pre><code>## (Intercept) 
##    0.106972</code></pre>
<p>How do these relate? Lets calculate ID 6 intercept random effect</p>
<pre class="r"><code>#coef = fixef + raneff

# coef for ID = 6 is 0.04724795  
0.106972 -0.0597240676 </code></pre>
<pre><code>## [1] 0.04724793</code></pre>
<p>To get residuals and fitted scores</p>
<pre class="r"><code>library(broom)
example.aug&lt;- augment(mod.1, data = example)


# .fitted    = predicted values
# .resid    = residuals/errors
# .fixed     = predicted values with no random effects</code></pre>
</div>
</div>
<div id="adding-time-to-the-mlm" class="section level2">
<h2>Adding time to the MLM</h2>
<div id="fixed-slope" class="section level3">
<h3>Fixed slope</h3>
<pre class="r"><code>mod.2f &lt;- lmer(SMN7 ~ 1 + year + (1  | ID), data=example)
summary(mod.2f)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: SMN7 ~ 1 + year + (1 | ID)
##    Data: example
## 
## REML criterion at convergence: -675.4
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.2308 -0.4868 -0.0377  0.4542  3.2337 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  ID       (Intercept) 0.001815 0.04261 
##  Residual             0.001300 0.03606 
## Number of obs: 216, groups:  ID, 88
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 0.104041   0.005733  18.147
## year        0.001331   0.001755   0.758
## 
## Correlation of Fixed Effects:
##      (Intr)
## year -0.426</code></pre>
<p>What does this look like graphically?</p>
</div>
<div id="random-slope" class="section level3">
<h3>Random slope</h3>
<pre class="r"><code>mod.2 &lt;- lmer(SMN7 ~ 1 + year + (year  | ID), data=example)
summary(mod.2)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: SMN7 ~ 1 + year + (year | ID)
##    Data: example
## 
## REML criterion at convergence: -678.1
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.93345 -0.47015 -0.00405  0.46985  2.67965 
## 
## Random effects:
##  Groups   Name        Variance  Std.Dev. Corr
##  ID       (Intercept) 1.688e-03 0.041085     
##           year        5.999e-05 0.007745 0.11
##  Residual             1.114e-03 0.033378     
## Number of obs: 216, groups:  ID, 88
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 0.104719   0.005466  19.157
## year        0.000489   0.001913   0.256
## 
## Correlation of Fixed Effects:
##      (Intr)
## year -0.339</code></pre>
<p>How does the intercept change from the random intercept only model? It may change because the intercept is now conditional on time ie after accounting for time. It is not the predicted outcome when time = 0. You can think of the previous intercept as the grand mean of person means. If our year variable here changed across time then there would be a larger change in the intercept.</p>
<p>How do you interpret year?</p>
<p>How did the random effects change?</p>
</div>
</div>
<div id="testing-models" class="section level2">
<h2>Testing models</h2>
<pre class="r"><code>anova(mod.2f, mod.2)</code></pre>
<pre><code>## refitting model(s) with ML (instead of REML)</code></pre>
<pre><code>## Data: example
## Models:
## mod.2f: SMN7 ~ 1 + year + (1 | ID)
## mod.2: SMN7 ~ 1 + year + (year | ID)
##        Df     AIC     BIC logLik deviance  Chisq Chi Df Pr(&gt;Chisq)
## mod.2f  4 -686.93 -673.43 347.46  -694.93                         
## mod.2   6 -685.45 -665.20 348.73  -697.45 2.5248      2      0.283</code></pre>
<p>Why is there a 2df difference?</p>
<p>also you can see the non-REML fit info here:</p>
<pre class="r"><code>glance(mod.2f)</code></pre>
<pre><code>## # A tibble: 1 x 6
##    sigma logLik   AIC   BIC deviance df.residual
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt;
## 1 0.0361   338. -667. -654.    -695.         212</code></pre>
<div id="why-treating-time-is-so-important" class="section level3">
<h3>Why treating time is so important</h3>
<p>Time with a different scale. How do we interpret? And what changes?</p>
<pre class="r"><code>example$year.n &lt;- (example$year - 30)
  
mod.2n &lt;- lmer(SMN7 ~ 1 + year.n + (year.n  | ID), data=example)</code></pre>
<pre><code>## Warning in checkConv(attr(opt, &quot;derivs&quot;), opt$par, ctrl =
## control$checkConv, : Model failed to converge with max|grad| = 1.99825 (tol
## = 0.002, component 1)</code></pre>
<pre class="r"><code>summary(mod.2n)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: SMN7 ~ 1 + year.n + (year.n | ID)
##    Data: example
## 
## REML criterion at convergence: -674.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.2053 -0.4841 -0.0423  0.4505  3.2646 
## 
## Random effects:
##  Groups   Name        Variance  Std.Dev.  Corr 
##  ID       (Intercept) 1.001e-03 0.0316327      
##           year.n      1.333e-07 0.0003652 -1.00
##  Residual             1.320e-03 0.0363343      
## Number of obs: 216, groups:  ID, 88
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept) 0.146910   0.050598   2.904
## year.n      0.001432   0.001763   0.812
## 
## Correlation of Fixed Effects:
##        (Intr)
## year.n 0.995 
## convergence code: 0
## Model failed to converge with max|grad| = 1.99825 (tol = 0.002, component 1)</code></pre>
<p>What happened?</p>
</div>
</div>
<div id="random-effects" class="section level2">
<h2>Random effects</h2>
<div id="calculation-of-random-effect-confidence-interval" class="section level3">
<h3>Calculation of random effect confidence interval</h3>
<p>Conveys the predicted range around each fixed effect in which 95% of the sample individuals are predicted to fall.</p>
<p>95% random effect = fixed effect plus minus 1.96 * random standard deviation</p>
<p>How to calculate?
1. Intercept <span class="math display">\[ \gamma_{00} \pm  1.96  *  \tau_{U_{0j}}  \]</span></p>
<pre class="r"><code>0.1193933 + (1.96 * 0.240217) </code></pre>
<pre><code>## [1] 0.5902186</code></pre>
<pre class="r"><code>0.1193933 - (1.96 * 0.240217) </code></pre>
<pre><code>## [1] -0.351432</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Slope <span class="math display">\[ \gamma_{10} \pm  1.96  *  \tau_{U_{1j}}  \]</span></li>
</ol>
<pre class="r"><code>0.0004891 + (1.96 * 0.007745) </code></pre>
<pre><code>## [1] 0.0156693</code></pre>
<pre class="r"><code>0.0004891 - (1.96 * 0.007745) </code></pre>
<pre><code>## [1] -0.0146911</code></pre>
<p>###Individual level random effects</p>
<p>Are the intercept random effects the same as the model with only the intercept? Why or why not?</p>
<pre class="r"><code>head(ranef(mod.1))</code></pre>
<pre><code>## $ID
##       (Intercept)
## 6   -0.0597240676
## 29  -0.0101119688
## 34  -0.0103698893
## 36  -0.0035902640
## 37  -0.0082433829
## 48   0.0455797808
## 53  -0.0222710793
## 54  -0.0066548052
## 58  -0.0060624543
## 61  -0.0271347235
## 66  -0.0123359896
## 67  -0.0026491341
## 69   0.0348398944
## 71  -0.0486040243
## 74   0.0484338355
## 75   0.0224228634
## 76  -0.0021583228
## 78   0.0224780927
## 79  -0.0054325535
## 80  -0.0194707993
## 81   0.0712662731
## 82   0.0053695094
## 85  -0.0532215425
## 86  -0.0388885304
## 87  -0.0387411472
## 89  -0.0208712287
## 91   0.0123812011
## 92  -0.0078125821
## 93   0.0430219016
## 94  -0.0543390588
## 96   0.0233440081
## 97  -0.0497003277
## 98  -0.0432302582
## 99   0.0104394983
## 101  0.0508032394
## 102 -0.0104344307
## 103 -0.0206130188
## 104 -0.0482473609
## 105 -0.0478231980
## 106 -0.0028045239
## 110  0.0418641247
## 112 -0.0109089622
## 114 -0.0549314098
## 115 -0.0013505715
## 116  0.0062422910
## 120  0.0300499418
## 122  0.0793976365
## 125  0.0532803435
## 127 -0.0105050866
## 129 -0.0448207025
## 135  0.0406255726
## 136 -0.0364069792
## 137 -0.0444890904
## 140 -0.0153440709
## 141  0.0770651692
## 142  0.0817077387
## 143  0.0072423981
## 144  0.0001680065
## 146 -0.0551006778
## 149 -0.0137965477
## 150  0.0091583792
## 152 -0.0187707293
## 153  0.0490992150
## 155 -0.0233396072
## 156 -0.0218943803
## 159 -0.0488368935
## 160  0.0024524455
## 162  0.0911638809
## 163  0.0155327007
## 165  0.0320764602
## 167 -0.0025217361
## 169  0.0647586755
## 171 -0.0397728293
## 174  0.0259232134
## 182 -0.0154177625
## 187 -0.0581588783
## 189  0.0348767402
## 190 -0.0030744230
## 193  0.0636533019
## 194  0.0099321407
## 201  0.0104848276
## 204  0.0414352908
## 205  0.0353188897
## 208  0.0033367444
## 209 -0.0346144188
## 211  0.0168223034
## 214 -0.0374146988
## 219  0.0564683729
## 222 -0.0262135788
## 223 -0.0228606119
## 229 -0.0484315899</code></pre>
<pre class="r"><code>head(ranef(mod.2))</code></pre>
<pre><code>## $ID
##       (Intercept)          year
## 6   -5.657190e-02 -0.0036945459
## 29  -8.481756e-03 -0.0012401120
## 34  -6.559720e-03 -0.0036272361
## 36  -7.107377e-03  0.0047529824
## 37  -7.584156e-03  0.0003779790
## 48   3.760800e-02  0.0079905136
## 53  -1.989445e-02 -0.0015608099
## 54   1.298061e-03 -0.0046572183
## 58   3.763976e-04 -0.0054304028
## 61  -2.523030e-02 -0.0013740463
## 66  -1.692834e-02  0.0022291440
## 67  -4.435808e-03  0.0020525694
## 71  -4.790346e-02  0.0002829010
## 75   2.147451e-02  0.0025670702
## 76  -1.178132e-03  0.0005880005
## 78   1.590422e-02  0.0031440504
## 79  -4.554999e-03  0.0005646937
## 80  -1.789820e-02 -0.0007154790
## 81   5.310404e-02  0.0082155118
## 82   4.163353e-03  0.0008114128
## 85  -5.229368e-02 -0.0013883325
## 86  -3.747004e-02 -0.0020088462
## 87  -3.530494e-02 -0.0042629307
## 89  -1.906497e-02 -0.0008530205
## 91   1.547560e-02 -0.0021933791
## 92  -5.127067e-03 -0.0012825084
## 93   3.779074e-02  0.0055466427
## 94  -5.318192e-02 -0.0005568113
## 96   2.535874e-02 -0.0004379578
## 97  -4.654850e-02 -0.0019515143
## 98  -3.875698e-02 -0.0027541673
## 99   9.785177e-03  0.0016155143
## 101  4.073120e-02  0.0116039230
## 103 -1.910831e-02 -0.0013254022
## 104 -4.656380e-02 -0.0034349757
## 105 -4.532176e-02 -0.0021913974
## 106  4.024883e-05 -0.0015454111
## 110  5.266477e-02 -0.0065630548
## 112 -5.482604e-03 -0.0041413140
## 114 -5.187791e-02 -0.0023737578
## 115 -6.018565e-04  0.0004676209
## 116  7.916722e-03 -0.0002939168
## 120  3.156554e-02  0.0021828094
## 122  7.845607e-02  0.0030220350
## 125  5.565560e-02 -0.0004030572
## 127 -1.035814e-02  0.0009947753
## 129 -4.383714e-02 -0.0011901610
## 135  4.517320e-02 -0.0027851051
## 136 -3.257406e-02 -0.0027536989
## 137 -4.307457e-02 -0.0026649722
## 140 -1.389973e-02 -0.0009470411
## 141  7.828180e-02  0.0011246004
## 142  7.656429e-02  0.0071700560
## 143  8.802167e-03  0.0001782843
## 144  5.023920e-04  0.0007247389
## 146 -5.190868e-02 -0.0030652978
## 149 -1.315714e-02  0.0001913378
## 150  1.329264e-02 -0.0028911814
## 152 -1.719482e-02 -0.0013669192
## 153  4.865193e-02  0.0022929034
## 155 -2.212352e-02 -0.0004931690
## 156 -2.041537e-02 -0.0004522343
## 159 -4.783022e-02 -0.0015435325
## 160  3.459146e-03  0.0001563020
## 162  8.771544e-02  0.0058967120
## 163  1.575853e-02  0.0011486036
## 165  3.244233e-02  0.0013196820
## 167 -5.436807e-04 -0.0009083619
## 169  6.576873e-02  0.0011926808
## 171 -3.475852e-02 -0.0047511867
## 174  2.798144e-02 -0.0004759192
## 182 -5.231973e-03 -0.0081378967
## 187 -5.609959e-02 -0.0019680493
## 189  3.456648e-02  0.0020405469
## 190 -1.620723e-03 -0.0003743333
## 193  5.854085e-02  0.0071786529
## 194  4.241261e-03  0.0066159420
## 201  1.187752e-02 -0.0001340229
## 204  3.799808e-02  0.0055309494
## 205  4.004323e-02 -0.0029413522
## 208  3.040083e-04  0.0043109412
## 209 -3.367017e-02 -0.0004225192
## 211  1.856239e-02 -0.0003192506
## 214 -3.676234e-02 -0.0001666149
## 219  4.541593e-02  0.0143735740
## 222 -1.947934e-02 -0.0063364890
## 223 -1.719018e-02 -0.0051038253
## 229 -4.254994e-02 -0.0060019177</code></pre>
</div>
</div>
<div id="using-simulations-to-get-better-estimates-of-confidence-around-our-estimates" class="section level2">
<h2>Using simulations to get better estimates of confidence around our estimates</h2>
<pre class="r"><code>library(broom.mixed)</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;broom.mixed&#39;:
##   method         from 
##   augment.lme    broom
##   augment.merMod broom
##   glance.lme     broom
##   glance.merMod  broom
##   glance.stanreg broom
##   tidy.brmsfit   broom
##   tidy.gamlss    broom
##   tidy.lme       broom
##   tidy.merMod    broom
##   tidy.rjags     broom
##   tidy.stanfit   broom
##   tidy.stanreg   broom</code></pre>
<pre><code>## 
## Attaching package: &#39;broom.mixed&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:broom&#39;:
## 
##     tidyMCMC</code></pre>
<pre class="r"><code>random_params &lt;- tidy(mod.2,  effects = &quot;ran_vals&quot;, conf.int=TRUE)
head(random_params)</code></pre>
<pre><code>## # A tibble: 6 x 8
##   effect   group level term        estimate std.error   conf.low conf.high
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 ran_vals ID    6     (Intercept) -0.0566     0.0181 -0.0920      -0.0212
## 2 ran_vals ID    29    (Intercept) -0.00848    0.0205 -0.0487       0.0317
## 3 ran_vals ID    34    (Intercept) -0.00656    0.0211 -0.0479       0.0348
## 4 ran_vals ID    36    (Intercept) -0.00711    0.0214 -0.0491       0.0349
## 5 ran_vals ID    37    (Intercept) -0.00758    0.0191 -0.0451       0.0299
## 6 ran_vals ID    48    (Intercept)  0.0376     0.0192 -0.0000131    0.0752</code></pre>
<pre class="r"><code>library(merTools)</code></pre>
<pre><code>## Loading required package: arm</code></pre>
<pre><code>## Loading required package: MASS</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre><code>## 
## arm (Version 1.10-1, built: 2018-4-12)</code></pre>
<pre><code>## Working directory is /Users/jackson/Box/5165 Applied Longitudinal Data Analysis/ALDA/content/Workshops</code></pre>
<pre class="r"><code>FEsim(mod.2)</code></pre>
<pre><code>##          term         mean       median          sd
## 1 (Intercept) 0.1049025608 0.1051183677 0.005295477
## 2        year 0.0007514429 0.0008749235 0.002054281</code></pre>
<pre class="r"><code>re.sim &lt;- REsim(mod.2)
head(re.sim)</code></pre>
<pre><code>##   groupFctr groupID        term         mean       median         sd
## 1        ID       6 (Intercept) -0.054039874 -0.054006147 0.01849033
## 2        ID      29 (Intercept) -0.005934701 -0.004010852 0.02089182
## 3        ID      34 (Intercept) -0.006448982 -0.007406987 0.01989969
## 4        ID      36 (Intercept) -0.006238323 -0.006724604 0.02380377
## 5        ID      37 (Intercept) -0.008978693 -0.008864176 0.02005051
## 6        ID      48 (Intercept)  0.038832930  0.037810554 0.01781832</code></pre>
<p>This can be used to create CIs for each individual random effect (and fixed effect). What is the confidence interval around person 6’s intercept estimate compared to person 2000 who has 25 repeated measurements?</p>
<div id="caterpillar-plots" class="section level3">
<h3>Caterpillar plots</h3>
<p>Look through these different methods of getting random effects. Note that they are not all exactly the same.</p>
<p>caterpillar plots</p>
<pre class="r"><code>p1 &lt;- plotREsim(re.sim)
p1</code></pre>
<p><img src="/Workshops/2019-09-04-workshop-2_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="density-of-individual-random-effects" class="section level3">
<h3>Density of individual random effects</h3>
<pre class="r"><code>p1.gg1 &lt;- re.sim %&gt;% 
  filter(term == &quot;(Intercept)&quot;) 

ggplot(p1.gg1, aes(mean)) +
  geom_density()</code></pre>
<p><img src="/Workshops/2019-09-04-workshop-2_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<pre class="r"><code>p1.gg2 &lt;- re.sim %&gt;% 
  filter(term == &quot;year&quot;) 


ggplot(p1.gg2, aes(mean)) +
  geom_density()</code></pre>
<p><img src="/Workshops/2019-09-04-workshop-2_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
</div>
<div id="comparing-to-a-standard-linear-model" class="section level2">
<h2>Comparing to a standard linear model</h2>
<pre class="r"><code>lm.1 &lt;- lm(SMN7 ~ 1 + year, data = example)
summary(lm.1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = SMN7 ~ 1 + year, data = example)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.099294 -0.039929 -0.005938  0.032715  0.169885 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 0.100161   0.005261  19.039   &lt;2e-16 ***
## year        0.004087   0.002563   1.595    0.112    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.05562 on 214 degrees of freedom
##   (9 observations deleted due to missingness)
## Multiple R-squared:  0.01174,    Adjusted R-squared:  0.007124 
## F-statistic: 2.543 on 1 and 214 DF,  p-value: 0.1123</code></pre>
<div id="comparing-models" class="section level3">
<h3>Comparing models</h3>
<p>LRT</p>
<p>Parametric bootstrap for CIs</p>
<pre class="r"><code>confint(mod.1, method=&quot;boot&quot;, nsim=1000)
summary(mod.1)

# uses SDs of random effects
# sigma = residual standard error</code></pre>
<p>Comparing two models. fit the reduced model, then repeatedly simulate from it and compute the differences between the deviance of the reduced and the full model for each simulated data set. Compare this null distribution to the observed deviance difference.</p>
<p>This procedure is implemented in the pbkrtest package.</p>
<pre class="r"><code>library(pbkrtest)
#pb &lt;- PBmodcomp(mod.2,mod.2r)</code></pre>
</div>
</div>
<div id="predictions-and-prediction-intervals" class="section level2">
<h2>Predictions and prediction intervals</h2>
<p>Predict function is deterministic and uses only the fixed effects (i.e. does not include random effects in the predictions). It does not do prediction in the typical sense where you are predicting <em>new</em> individual’s scores.</p>
<p>Simulate is non-deterministic because it samples random effect values for all subjects and then samples from the conditional distribution. Simulation is needed to create true predictions.</p>
<div id="predictions-and-prediction-intervals-1" class="section level3">
<h3>Predictions and prediction intervals</h3>
<p>Predict function is deterministic and uses only the fixed effects (i.e. does not include random effects in the predictions). It does not do prediction in the typical sense where you are predicting <em>new</em> individual’s scores.</p>
<p>Simulate is non-deterministic because it samples random effect values for all subjects and then samples from the conditional distribution. Simulation is needed to create true predictions.</p>
<p>Short of a fully Bayesian analysis, bootstrapping is the gold-standard for deriving prediction intervals/bands (ie where would a new person score given X), but the time required is typically high.</p>
<p>In order to generate a proper prediction (for either a new person or a new observation within a person), a prediction must account for three sources of uncertainty in mixed models:</p>
<ol style="list-style-type: decimal">
<li>the residual (observation-level) variance,</li>
<li>the uncertainty in the fixed coefficients, and</li>
<li>the uncertainty in the variance parameters for the random effects</li>
</ol>
<p>Does so by:
1. extracting the fixed and random coefficients
2. takes n draws from the multivariate normal distribution of the fixed and random coefficients (separately)
3. calculates the linear predictor for each row in newdata based on these draws, and
4. incorporates the residual variation<br />
then:
5. returns newdata with the lower and upper limits of the prediction interval and the mean or median of the simulated predictions</p>
<pre class="r"><code>library(merTools)
# see also their shiny app: shinyMer(mod.1)

PI &lt;- predictInterval(merMod = mod.2, newdata = example, level = 0.9, n.sims = 100, stat = &quot;median&quot;, include.resid.var = TRUE)
head(PI)</code></pre>
<pre><code>##          fit       upr         lwr
## 1 0.05637403 0.1097137 -0.01587163
## 2 0.04308280 0.1112285 -0.01217230
## 3 0.02906342 0.1003347 -0.02107285
## 4 0.08963131 0.1538768  0.02283071
## 5 0.09504809 0.1510902  0.03936437
## 6 0.10191796 0.1657385  0.02358774</code></pre>
<p>Nice for bringing in confidence bands around your prediction (And we might use this later)</p>
<p>Broom offers the fitted (predicted) values already if you just want to plot your trajectory. But note that these are not typical prediction intervals (what happens if you get a new participant with a certain value of X). The bands fit in ggplot are for predicted <span class="math inline">\(\mu\)</span>|X</p>
<p>Broom offers the fitted (predicted) values already if you just want to plot your trajectory. But note that these are not typical prediction intervals (what happens if you get a new participant with a certain value of X). The bands fit in ggplot are for predicted <span class="math inline">\(\mu\)</span>|X</p>
<pre class="r"><code>P.gg &lt;- ggplot(example.aug, aes(x= year, y = .fitted)) + geom_point() + stat_smooth(method = &quot;lm&quot;)   

P.gg</code></pre>
<pre><code>## Warning: Removed 9 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 9 rows containing missing values (geom_point).</code></pre>
<p><img src="/Workshops/2019-09-04-workshop-2_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>Can also explicitly simulate new data (rather than rely on another function to do so), which will be useful for power calculations later. In the simulated data, the subject means are different from the means in the original data because simulate samples by-subject random effect values using the variance components in the fitted model.</p>
<pre class="r"><code>sim.1&lt;- simulate(mod.2)
head(sim.1)</code></pre>
</div>
</div>
</div>

    </div>

    


    



    
      








  
  
  







      
      
    

    
    <div class="article-widget">
      
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/workshops/workshop-3/" rel="next">Workshop #3</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/workshops/workshop-1/" rel="prev">Workshop Week 1</a>
  </div>
  
</div>

    </div>
    

    


  </div>
</article>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.0.0/mermaid.min.js" integrity="sha256-0w92bcB21IY5+rGI84MGj52jNfHNbXVeQLrZ0CGdjNY=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/r.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.16bbb3750feb7244c9bc409a5a4fe678.js"></script>

    






  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/terms/">Terms</a>
        
  </p>
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
